<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Saige | HUNT Cloud Documentation</title>
    <meta name="description" content="HUNT Cloud Documentation">
    <link rel="shortcut icon" href="https://www.ntnu.no/assets/images/favicon.ico">
  <meta name="theme-color" content="#00509e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.c787bbb8.css" as="style"><link rel="preload" href="/assets/js/app.8a7d0012.js" as="script"><link rel="preload" href="/assets/js/2.ea2d0de1.js" as="script"><link rel="preload" href="/assets/js/35.b53f9cb7.js" as="script"><link rel="prefetch" href="/assets/js/10.66be55d4.js"><link rel="prefetch" href="/assets/js/11.88ad7a88.js"><link rel="prefetch" href="/assets/js/12.331f988b.js"><link rel="prefetch" href="/assets/js/13.ae1bf82c.js"><link rel="prefetch" href="/assets/js/14.93b3a72a.js"><link rel="prefetch" href="/assets/js/15.17bb07c0.js"><link rel="prefetch" href="/assets/js/16.89056382.js"><link rel="prefetch" href="/assets/js/17.eec430a4.js"><link rel="prefetch" href="/assets/js/18.af4689ee.js"><link rel="prefetch" href="/assets/js/19.4781a4d4.js"><link rel="prefetch" href="/assets/js/20.9195444f.js"><link rel="prefetch" href="/assets/js/21.2677604b.js"><link rel="prefetch" href="/assets/js/22.61c6a771.js"><link rel="prefetch" href="/assets/js/23.7f612afb.js"><link rel="prefetch" href="/assets/js/24.c6d96dbc.js"><link rel="prefetch" href="/assets/js/25.0429148e.js"><link rel="prefetch" href="/assets/js/26.fe5b0f5c.js"><link rel="prefetch" href="/assets/js/27.e8f57ba1.js"><link rel="prefetch" href="/assets/js/28.ff839037.js"><link rel="prefetch" href="/assets/js/29.90594df1.js"><link rel="prefetch" href="/assets/js/3.94e738ea.js"><link rel="prefetch" href="/assets/js/30.c275f06b.js"><link rel="prefetch" href="/assets/js/31.9cd56a7d.js"><link rel="prefetch" href="/assets/js/32.e07f1e7d.js"><link rel="prefetch" href="/assets/js/33.19d1203c.js"><link rel="prefetch" href="/assets/js/34.9159103a.js"><link rel="prefetch" href="/assets/js/36.d9df12c9.js"><link rel="prefetch" href="/assets/js/37.38d57bbd.js"><link rel="prefetch" href="/assets/js/38.40406acd.js"><link rel="prefetch" href="/assets/js/39.aadd69e5.js"><link rel="prefetch" href="/assets/js/4.e7385dc5.js"><link rel="prefetch" href="/assets/js/40.2962d828.js"><link rel="prefetch" href="/assets/js/41.72f7846c.js"><link rel="prefetch" href="/assets/js/42.61b6a2cf.js"><link rel="prefetch" href="/assets/js/43.5f5b36df.js"><link rel="prefetch" href="/assets/js/44.20863ac6.js"><link rel="prefetch" href="/assets/js/45.85ed0ad5.js"><link rel="prefetch" href="/assets/js/5.9bdfcfaf.js"><link rel="prefetch" href="/assets/js/6.fd8f8e74.js"><link rel="prefetch" href="/assets/js/7.52aabe93.js"><link rel="prefetch" href="/assets/js/8.23842021.js"><link rel="prefetch" href="/assets/js/9.7fb704f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c787bbb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HUNT Cloud Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/getting-started/" class="nav-link">Getting started</a></div> <a href="https://github.com/huntdatacenter/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/getting-started/" class="nav-link">Getting started</a></div> <a href="https://github.com/huntdatacenter/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/" class="sidebar-link">Welcome</a></li><li><a href="/about/" class="sidebar-link">About</a></li><li><a href="/contribute/" class="sidebar-link">Contribute</a></li><li><a href="/contact/" class="sidebar-link">Contact us</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Working in your lab</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/working-in-your-lab/" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Technical tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Analytical tools</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/working-in-your-lab/analytical-tools/" class="sidebar-link">Introduction</a></li><li><a href="/working-in-your-lab/analytical-tools/conda/" class="sidebar-link">Conda</a></li><li><a href="/working-in-your-lab/analytical-tools/epacts/" class="sidebar-link">EPACTS</a></li><li><a href="/working-in-your-lab/analytical-tools/fsl/" class="sidebar-link">FSL</a></li><li><a href="/working-in-your-lab/analytical-tools/freesurfer/" class="sidebar-link">Freesurfer</a></li><li><a href="/working-in-your-lab/analytical-tools/jupyter-lab/" class="sidebar-link">Jupyter LAB</a></li><li><a href="/working-in-your-lab/analytical-tools/matlab/" class="sidebar-link">Matlab</a></li><li><a href="/working-in-your-lab/analytical-tools/plink/" class="sidebar-link">PLINK</a></li><li><a href="/working-in-your-lab/analytical-tools/r-studio/" class="sidebar-link">R and R-Studio</a></li><li><a href="/working-in-your-lab/analytical-tools/saige/" class="active sidebar-link">Saige</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#defining-your-software-directory" class="sidebar-link">Defining your software directory</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#install-required-apt-packages" class="sidebar-link">Install required APT packages</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#defining-your-java-version" class="sidebar-link">Defining your Java version</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#installing-required-python-packages" class="sidebar-link">Installing required python packages</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#installing-a-specific-r-version" class="sidebar-link">Installing a specific R version</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#installing-saige" class="sidebar-link">Installing SAIGE</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#set-number-of-threads-for-openblas" class="sidebar-link">Set number of threads for openblas</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#cleanup" class="sidebar-link">Cleanup</a></li><li class="sidebar-sub-header"><a href="/working-in-your-lab/analytical-tools/saige/#testing-saige" class="sidebar-link">Testing SAIGE</a></li></ul></li><li><a href="/working-in-your-lab/analytical-tools/spyder-ide/" class="sidebar-link">Spyder IDE</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Troubleshooting</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="saige-package-for-r-on-an-iaas-machine"><a href="#saige-package-for-r-on-an-iaas-machine" class="header-anchor">#</a> Saige package for R on an IAAS machine</h1> <p>This page describes installation of the <a href="https://github.com/weizhouUMICH/SAIGE" target="_blank" rel="noopener noreferrer">SAIGE R package<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
on a clean IAAS or BLUE machine in HUNT Cloud.</p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p><a href="https://github.com/weizhouUMICH/SAIGE" target="_blank" rel="noopener noreferrer">SAIGE is an R package<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with Scalable and
Accurate Implementation of Generalized mixed model (Chen, H. et al. 2016).
It accounts for sample relatedness and is feasible for genetic association tests
in large cohorts and biobanks (N &gt; 400,000).
The below guide is based on packages listed in the Dockerfile example in Github.</p> <h2 id="requirements"><a href="#requirements" class="header-anchor">#</a> Requirements</h2> <p>Ubuntu operating system (current installation is tested on 18.04)
Administrator privileges (HUNT IAAS or HUNT BLUE machines)
Fresh coffee and 30 minutes to spare</p> <h2 id="defining-your-software-directory"><a href="#defining-your-software-directory" class="header-anchor">#</a> Defining your software directory</h2> <p>Below is an example:</p> <div class="language- extra-class"><pre class="language-text"><code># Define your software directory
software_dir=&quot;/home/ubuntu/software/&quot;

# Create directory if it don't exist
mkdir -p $software_dir

# Move into the directory
cd $software_dir
</code></pre></div><h2 id="install-required-apt-packages"><a href="#install-required-apt-packages" class="header-anchor">#</a> Install required APT packages</h2> <div class="language- extra-class"><pre class="language-text"><code>sudo apt update -y &amp;&amp; sudo apt-get install -y \
    build-essential \
    cmake \
    curl \
    libboost-all-dev \
    libbz2-dev \
    libcairo2-dev \
    libcurl4-openssl-dev \
    liblzma-dev \
    libopenblas-dev \
    libpcre3-dev \
    libpng-dev \
    libreadline-dev \
    libssl-dev \
    libz-dev \
    python3-pip \
    python3-setuptools \
    unzip \
    gfortran \
    r-cran-rjava \
    openjdk-8-jdk
</code></pre></div><h2 id="defining-your-java-version"><a href="#defining-your-java-version" class="header-anchor">#</a> Defining your Java version</h2> <p>Run the code below and manually choose java-8in the provided list and hit 'ENTER'.</p> <div class="language- extra-class"><pre class="language-text"><code># manual update to java-8-openjdk
sudo update-alternatives --config java
</code></pre></div><h2 id="installing-required-python-packages"><a href="#installing-required-python-packages" class="header-anchor">#</a> Installing required python packages</h2> <div class="language- extra-class"><pre class="language-text"><code>pip3 install cget;
</code></pre></div><h2 id="installing-a-specific-r-version"><a href="#installing-a-specific-r-version" class="header-anchor">#</a> Installing a specific R version</h2> <p>The current SAIGE version requires a specific R-version (3.5.1). The below snippets compile this specific version.</p> <div class="language- extra-class"><pre class="language-text"><code># ensure software dir
cd $software_dir

# define version
r_version=&quot;3.5.1&quot;;

# download
curl -O https://cloud.r-project.org/src/base/R-3/R-${r_version}.tar.gz;

# unzip
tar xvzf R-${r_version}.tar.gz;

# cleanup
rm R-${r_version}.tar.gz;

# move into r-folder
cd $software_dir/R-${r_version}

# configure
sudo ./configure \
  --with-x=no \
  --with-blas=&quot;-lopenblas&quot; \
  --enable-R-shlib  \
  -enable-shared;

# make
sudo make; # TODO stopped here
sudo mkdir -p /usr/local/lib/R/lib;

# install
sudo make install;

# cleanup
cd $software_dir
sudo rm -rf $software_dir/R-${r_version}
</code></pre></div><h2 id="installing-saige"><a href="#installing-saige" class="header-anchor">#</a> Installing SAIGE</h2> <div class="language- extra-class"><pre class="language-text"><code>cd $software_dir

# Download latest version
curl -OL https://github.com/weizhouUMICH/SAIGE/archive/master.zip

# Unpack
unzip master.zip

# Update file folder names
mv SAIGE-master/ SAIGE/

# Install required R-packages
Rscript SAIGE/extdata/install_packages.R

# Install SAIGE
R CMD INSTALL SAIGE
</code></pre></div><h2 id="set-number-of-threads-for-openblas"><a href="#set-number-of-threads-for-openblas" class="header-anchor">#</a> Set number of threads for openblas</h2> <p>This steps adds a thread restriction on BLAS to avoid multithread
conflicts with other R packages.</p> <p>First, add restriction to <code>step2_SPAtests.R</code></p> <div class="language- extra-class"><pre class="language-text"><code>echo &quot;#!/usr/bin/env Rscript

# Restrict threads in openblas
hasOpenBlas = grepl(\&quot;openblas\&quot;,extSoftVersion()[\&quot;BLAS\&quot;]);
if (hasOpenBlas) {
  ### Only when using openblas instead of blas
  require(inline)
  openblas.set.num.threads &lt;- cfunction( signature(ipt=\&quot;integer\&quot;),
    body = \'openblas_set_num_threads(*ipt);\',
    otherdefs = c (\'extern void openblas_set_num_threads(int);\'),
      libargs = c (\'-L/opt/openblas/lib -lopenblas\'),
      language = \&quot;C\&quot;,
      convention = \&quot;.C\&quot;)};
if (hasOpenBlas) openblas.set.num.threads(1)
&quot; &gt; insert_openblas_restriction.tmp
</code></pre></div><p>Then, add to file:</p> <div class="language- extra-class"><pre class="language-text"><code># cut header
cat SAIGE/extdata/step2_SPAtests.R | sed -n '1!p' &gt; step2_body.tmp
</code></pre></div><h1 id="combine"><a href="#combine" class="header-anchor">#</a> Combine</h1> <div class="language- extra-class"><pre class="language-text"><code>cat insert_openblas_restriction.tmp \
    step2_body.tmp &gt; step2_SPAtests.R
Install the required 'inline' R-package:
echo 'req_packages &lt;- &quot;inline&quot;;
for (pack in req_packages) {
  if(!require(pack,character.only = TRUE)) {
    install.packages(pack, repos = &quot;http://cran.us.r-project.org&quot;)}}' \
&gt; install_inline.R
Rscript install_inline.R
rm install_inline.R
</code></pre></div><p>Add quick references:</p> <div class="language- extra-class"><pre class="language-text"><code># Move files to usr/local/bin for quick referencing
sudo mv SAIGE/extdata/step1_fitNULLGLMM.R /usr/local/bin/
sudo mv step2_SPAtests.R /usr/local/bin/
sudo mv SAIGE/extdata/createSparseGRM.R /usr/local/bin/
sudo chmod a+x /usr/local/bin/*.R
</code></pre></div><h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <div class="language- extra-class"><pre class="language-text"><code>rm -rf master.zip
rm -rf SAIGE
rm insert_openblas_restriction.tmp
rm step2_body.tmp
rm step2_SPAtests.R
</code></pre></div><h2 id="testing-saige"><a href="#testing-saige" class="header-anchor">#</a> Testing SAIGE</h2> <div class="language- extra-class"><pre class="language-text"><code>step1_fitNULLGLMM.R

step2_SPAtests.R

createSparseGRM.R
</code></pre></div><p>More information</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/huntdatacenter/docs/edit/master/docs/working-in-your-lab/analytical-tools/saige.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/27/2020, 9:21:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/working-in-your-lab/analytical-tools/r-studio/" class="prev">R and R-Studio</a></span> <span class="next"><a href="/working-in-your-lab/analytical-tools/spyder-ide/">Spyder IDE</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8a7d0012.js" defer></script><script src="/assets/js/2.ea2d0de1.js" defer></script><script src="/assets/js/35.b53f9cb7.js" defer></script>
  </body>
</html>
